<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>WildPointer  | SSL Certificate Revocation Check in Java</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.53-DEV" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.955516233bcafa4d2a1c13cea63c7b50.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="SSL Certificate Revocation Check in Java" />
<meta property="og:description" content="A SSL certificate can be revoked and becomes invalid before the issued expiration time. A Certificate Authority (CA) can publish a list of revoked certificates (CRL) for clients to download. Java has builtin support for certificate revocation status check. Similar to all other Java security features, the implementation is provider based. The default provider is from the sun package.
Please note that I am aware that OCSP or OCSP stapling should be preferred over CRL." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ywangd.github.io/posts/crl-check-in-java/" /><meta property="article:published_time" content="2019-06-17T21:31:11&#43;10:00"/>
<meta property="article:modified_time" content="2019-06-17T21:31:11&#43;10:00"/>

<meta itemprop="name" content="SSL Certificate Revocation Check in Java">
<meta itemprop="description" content="A SSL certificate can be revoked and becomes invalid before the issued expiration time. A Certificate Authority (CA) can publish a list of revoked certificates (CRL) for clients to download. Java has builtin support for certificate revocation status check. Similar to all other Java security features, the implementation is provider based. The default provider is from the sun package.
Please note that I am aware that OCSP or OCSP stapling should be preferred over CRL.">


<meta itemprop="datePublished" content="2019-06-17T21:31:11&#43;10:00" />
<meta itemprop="dateModified" content="2019-06-17T21:31:11&#43;10:00" />
<meta itemprop="wordCount" content="625">



<meta itemprop="keywords" content="java,SSL," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SSL Certificate Revocation Check in Java"/>
<meta name="twitter:description" content="A SSL certificate can be revoked and becomes invalid before the issued expiration time. A Certificate Authority (CA) can publish a list of revoked certificates (CRL) for clients to download. Java has builtin support for certificate revocation status check. Similar to all other Java security features, the implementation is provider based. The default provider is from the sun package.
Please note that I am aware that OCSP or OCSP stapling should be preferred over CRL."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  
  
  <header class="cover bg-top" style="background-image: url('https://ywangd.github.io/images/butterfly-school.jpg');">
    <div class="pb3-m pb6-l bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://ywangd.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      WildPointer
    </a>
    <div class="flex-l items-center">
      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/posts/" title="Articles page">
              Articles
            </a>
          </li>
          
        </ul>
      
      
<div hidden>
  <span id="new-window-0">Opens in a new window</span>
  <span id="new-window-1">Opens an external site</span>
  <span id="new-window-2">Opens an external site in a new window</span>
</div>







<a href="https://github.com/ywangd" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-describedby="new-window-0">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>



    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">SSL Certificate Revocation Check in Java</h1>
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3 ph0-l">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        ARTICLES
      </p>
      <h1 class="f1 athelas mb1">SSL Certificate Revocation Check in Java</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2019-06-17T21:31:11&#43;10:00">June 17, 2019</time>      
      
      
    </header>

    <main class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">

<p>A SSL certificate can be revoked and becomes invalid before the issued expiration time. A Certificate Authority (CA) can publish a <a href="https://en.wikipedia.org/wiki/Certificate_revocation_list">list of revoked certificates (CRL)</a> for clients to download. Java has builtin support for certificate revocation status check. Similar to all other Java security features, the implementation is <a href="https://docs.oracle.com/en/java/javase/11/security/oracle-providers.html#GUID-FE2D2E28-C991-4EF9-9DBE-2A4982726313">provider</a> based. The default provider is from the <code>sun</code> package.</p>

<p><em>Please note that I am aware that <a href="https://en.wikipedia.org/wiki/Online_Certificate_Status_Protocol">OCSP</a> or <a href="https://en.wikipedia.org/wiki/OCSP_stapling">OCSP stapling</a> should be preferred over CRL. I am also aware that the whole revocation checking design is sometimes considered problematic. This article by no means advocates the use of CRL. It is merely a technical discussion about its usage and implementation in Java.</em></p>

<h2 id="important-classes">Important Classes</h2>

<h3 id="certpathbuilder-and-certpathvalidator"><code>CertPathBuilder</code> and <code>CertPathValidator</code></h3>

<p>Both are factory classes for retrieving concrete implementations by specifying algorithm and provider parameters:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CertPathBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">getInstance</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;PKIX&#34;</span><span style="color:#f92672">);</span>
CertPathValidator<span style="color:#f92672">.</span><span style="color:#a6e22e">getInstance</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;PKIX&#34;</span><span style="color:#f92672">);</span></code></pre></div>

<p>The underlying engine classes return from above code are <code>SunCertPathBuilder</code> and <code>PKIXCertPathValidator</code>, respectively. Although they are distinct classes, both of them can be used to perform revocation check and the underlying process is almost identical. When revocation status is checked, they both delegate to <code>RevocationChecker</code>.</p>

<h3 id="pkixrevocationchecker-and-revocationchecker"><code>PKIXRevocationChecker</code> and <code>RevocationChecker</code></h3>

<p><code>PKIXRevocationChecker</code> is the abstract super class from <code>java.security.cert</code> package, while <code>RevocationChecker</code> is the concrete implementation from <code>sun.security.provider.certpath</code> package. As <a href="https://www.oracle.com/technetwork/java/faq-sun-packages-142232.html">best practice</a>, we should not directly refer classes from <code>sun</code> packages. Instead, we should stick to <code>PKIXRevocationChecker</code> even though the runtime object is of type <code>RevocationChecker</code>.</p>

<p><code>RevocationChecker</code> does the actual revocation status check. It retrieves CRL from CA&rsquo;s distribution point. By default, this class is configured with <code>PREFER_OCSP</code> so that <a href="https://en.wikipedia.org/wiki/Online_Certificate_Status_Protocol">OCSP</a> is preferred over CRL. To enable CRL, it needs to be explicitly configured with the <code>PREFER_CRLS</code> option, e.g:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CertPathBuilder certPathBuilder <span style="color:#f92672">=</span> CertPathBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">getInstance</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;PKIX&#34;</span><span style="color:#f92672">);</span>
PKIXRevocationChecker revocationChecker <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>PKIXRevocationChecker<span style="color:#f92672">)</span> certPathBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">getRevocationChecker</span><span style="color:#f92672">();</span>
Set<span style="color:#f92672">&lt;</span>PKIXRevocationChecker<span style="color:#f92672">.</span><span style="color:#a6e22e">Option</span><span style="color:#f92672">&gt;</span> opts <span style="color:#f92672">=</span> EnumSet<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span>PKIXRevocationChecker<span style="color:#f92672">.</span><span style="color:#a6e22e">Option</span><span style="color:#f92672">.</span><span style="color:#a6e22e">PREFER_CRLS</span><span style="color:#f92672">);</span>
revocationChecker<span style="color:#f92672">.</span><span style="color:#a6e22e">setOptions</span><span style="color:#f92672">(</span>opts<span style="color:#f92672">);</span></code></pre></div>

<h3 id="distributionpointfetcher"><code>DistributionPointFetcher</code></h3>

<p>This is a static utility class from the <code>sun</code> package. It is used internally by <code>RevocationChecker</code> to retrieve CRL from CA&rsquo;s distribution point. All the inner workings are purely implementation details and end-users need not worry about it.</p>

<h3 id="pkixparameters"><code>PKIXParameters</code></h3>

<p>This parameter class is used to configure the behavior of <code>CertPathBuilder</code> and <code>CertPathValidator</code>.
For <code>CertPathBuilder</code>, the <code>PKIXBuilderParameters</code> subclass provides an additional method to specify max length of the certificate chain.</p>

<h3 id="certstore"><code>CertStore</code></h3>

<p>A <code>CertStore</code> is needed to lookup certificates in the process of building <code>CertPath</code>. Do note that any root CA should <strong>not</strong> be added to a <code>CertStore</code>, otherwise following exception will be thrown:</p>

<pre><code class="language-text">sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
</code></pre>

<p>This is because a Root CA does not have an issuer, which is always required by the <code>CertPathBuilder</code>.</p>

<h2 id="system-properties">System Properties</h2>

<h3 id="com-sun-security-enablecrldp"><code>com.sun.security.enableCRLDP</code></h3>

<p>Many tutorials state that above property controls whether CRL is fetched from CA&rsquo;s distribution point. This is only partially true. This property takes effect only when a <code>RevocationChecker</code> is in <em>legacy</em> mode. The legacy mode is activated if <code>RevocationChecker</code> is instantiated with the constructor of signature <code>RevocationChecker(TrustAnchor, ValidatorParams)</code>. This happens when:</p>

<ul>
<li><code>PKIXParameters.revocationEnabled</code> is set to <code>true</code>, and</li>
<li>No <code>RevocationChecker</code> is configured for the <code>PKIXParameters</code>.</li>
</ul>

<p>If a <code>RevocationChecker</code> is retrieved with <code>getRevocationChecker</code> method of either <code>CertPathBuilder</code> or <code>CertPathValidator</code>, the returned <code>RevocationChecker</code> instance is <strong>not</strong> in legacy mode and thus always fetches CRL online, e.g.:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">PKIXRevocationChecker revocationChecker <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>PKIXRevocationChecker<span style="color:#f92672">)</span> certPathBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">getRevocationChecker</span><span style="color:#f92672">();</span>
Set<span style="color:#f92672">&lt;</span>PKIXRevocationChecker<span style="color:#f92672">.</span><span style="color:#a6e22e">Option</span><span style="color:#f92672">&gt;</span> opts <span style="color:#f92672">=</span> EnumSet<span style="color:#f92672">.</span><span style="color:#a6e22e">of</span><span style="color:#f92672">(</span>PKIXRevocationChecker<span style="color:#f92672">.</span><span style="color:#a6e22e">Option</span><span style="color:#f92672">.</span><span style="color:#a6e22e">PREFER_CRLS</span><span style="color:#f92672">);</span>
revocationChecker<span style="color:#f92672">.</span><span style="color:#a6e22e">setOptions</span><span style="color:#f92672">(</span>opts<span style="color:#f92672">);</span>
PKIXBuilderParameters pkixBuilderParameters <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> PKIXBuilderParameters<span style="color:#f92672">(</span>keyStore<span style="color:#f92672">,</span> certSelect<span style="color:#f92672">);</span>
pkixBuilderParameters<span style="color:#f92672">.</span><span style="color:#a6e22e">addCertPathChecker</span><span style="color:#f92672">(</span>pkixRevocationChecker<span style="color:#f92672">);</span></code></pre></div>

<p>Also note that <code>PKIXParameters.revocationEnabled</code> is completely ignored when a <code>RevocationChecker</code> is explicitly configured as above. In another word, it is basically always true when <code>RevocationChecker</code> is explicitly set.</p>

<h3 id="com-sun-net-ssl-checkrevocation"><code>com.sun.net.ssl.checkRevocation</code></h3>

<p>This property is less well-known and used by <code>sun.security.validator.PKIXValidator</code>. This class is not part of the provider architecture and hence can only be instantiated directly. As best practice, we should not directly use it since it is from the <code>sun</code> package. Internally it calls <code>CertPathValidator.getInstance(&quot;PKIX&quot;)</code> and just delegates validation to the returned <code>CertPathValidator</code>. Therefore there really is no good reason for an end-user to use this class at all.</p>
<ul class="pa0">
  
   <li class="list">
     <a href="/tags/java" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">java</a>
   </li>
  
   <li class="list">
     <a href="/tags/ssl" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">SSL</a>
   </li>
  
</ul>
<div class="mt6">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "ywangd" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </main>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-navy bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://ywangd.github.io/" >
    &copy; 2019 WildPointer
  </a>
    <div>
<div hidden>
  <span id="new-window-0">Opens in a new window</span>
  <span id="new-window-1">Opens an external site</span>
  <span id="new-window-2">Opens an external site in a new window</span>
</div>







<a href="https://github.com/ywangd" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-describedby="new-window-0">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
